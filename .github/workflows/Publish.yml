/*
 *  =======================================================================
 *  ยทยทยทยทY88bยทยทยทd88Pยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท888bยทยทยทยทยทd888ยทd8bยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท
 *  ยทยทยทยทยทY88bยทd88Pยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท8888bยทยทยทd8888ยทY8Pยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท
 *  ยทยทยทยทยทยทY88o88Pยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท88888bยทd88888ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท
 *  ยทยทยทยทยทยทยทY888Pยทยท8888bยทยทยท88888bยทยทยท888Y88888P888ยท888ยท88888bยทยทยทยทยทd88bยทยทยทยทยทยทยท
 *  ยทยทยทยทยทยทยทยท888ยทยทยทยทยทยท"88bยท888ยท"88bยท888ยทY888Pยท888ยท888ยท888ยท"88bยทd88P"88bยทยทยทยทยท
 *  ยทยทยทยทยทยทยทยท888ยทยทยทd888888ยท888ยทยท888ยท888ยทยทY8Pยทยท888ยท888ยท888ยทยท888ยท888ยทยท888ยทยทยทยทยท
 *  ยทยทยทยทยทยทยทยท888ยทยท888ยทยท888ยท888ยทยท888ยท888ยทยทยท"ยทยทยท888ยท888ยท888ยทยท888ยทY88bยท888ยทยทยทยทยท
 *  ยทยทยทยทยทยทยทยท888ยทยท"Y888888ยท888ยทยท888ยท888ยทยทยทยทยทยทยท888ยท888ยท888ยทยท888ยทยท"Y88888ยทยทยทยทยท
 *  ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท888ยทยทยทยทยท
 *  ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทY8bยทd88Pยทยทยทยทยท
 *  ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท"Y88P"ยทยทยทยทยทยท
 *  =======================================================================
 * 
 *  -----------------------------------------------------------------------
 * Author       : ็ฑ้ญ
 * Date         : 2024-08-27 19:36:38 +0800
 * LastEditTime : 2024-08-27 19:54:44 +0800
 * Github       : https://github.com/YanMing-lxb/
 * FilePath     : /PyTeXMK/.github/workflows/Publish.yml
 * Description  : 
 *  -----------------------------------------------------------------------
 */

name: Publish pytexmk ๐  # ๅฎไนๅทฅไฝๆต็ๅ็งฐ๏ผๅฝๆจ้ๅน้็ๆ็ญพๆถๅๅธๅฐPyPI
on:
  push:
    tags:
      - v*  # ๅฝๆจ้ไปฅvๅผๅคด็ๆ็ญพๆถ่งฆๅๆญคๅทฅไฝๆต

jobs:
  build:
    name: Build PyTeXMK  # ๅฎไนๆๅปบไฝไธ็ๅ็งฐ
    runs-on: ubuntu-latest  # ๆๅฎ่ฟ่กๆญคไฝไธ็ๆไฝ็ณป็ป

    steps:
    - name: Checkout source  # ๆฃๅบๆบไปฃ็็ๆญฅ้ชค
      uses: actions/checkout@v4  # ไฝฟ็จactions/checkoutๅจไฝๆฅๆฃๅบไปฃ็

    - name: Set up ๐ Python  # ่ฎพ็ฝฎPython็ฏๅข็ๆญฅ้ชค
      uses: actions/setup-python@v5  # ไฝฟ็จactions/setup-pythonๅจไฝๆฅ่ฎพ็ฝฎPython็ฏๅข
      with:
        python-version: "3.x"  # ๆๅฎPython็ๆฌไธบ3.x

    - name: Build ๐ฆ source and wheel  # ๆๅปบๆบไปฃ็ๅwheelๅ็ๆญฅ้ชค
      run: |
        python3 -m pip install --upgrade build twine rich  # ๅฎ่ฃๆๅปบๅไธไผๆ้็ๅทฅๅท
        python3 -m build  # ๆๅปบๆบไปฃ็ๅwheelๅ

    - name: Store the distribution packages  # ๅญๅจๆๅปบๅฅฝ็ๅๅๅ็ๆญฅ้ชค
      uses: actions/upload-artifact@v4  # ไฝฟ็จactions/upload-artifactๅจไฝๆฅไธไผๆๅปบๅฅฝ็ๅ
      with:
        name: python-package-distributions  # ๆๅฎไธไผ็artifactๅ็งฐ
        path: dist/  # ๆๅฎ่ฆไธไผ็ๆไปถ่ทฏๅพ

  publish-to-pypi:
    name: Publish ๐ PyTeXMK ๐ฆ to PyPI  # ๅฎไนๅๅธๅฐPyPIไฝไธ็ๅ็งฐ
    if: startsWith(github.ref, 'refs/tags/')  # ๅชๆๅจๆจ้ๆ็ญพๆถๆๆง่กๆญคไฝไธ
    needs: build  # ๆๅฎๆญคไฝไธไพ่ตไบbuildไฝไธ
    runs-on: ubuntu-latest  # ๆๅฎ่ฟ่กๆญคไฝไธ็ๆไฝ็ณป็ป
    environment:
      name: pypi  # ๅฎไน็ฏๅขๅ็งฐ
      url: https://pypi.org/project/pytexmk  # ๆฟๆขไธบๅฎ้็PyPI้กน็ฎURL
    permissions:
      contents: read  # ้่ฆ่ฏปๅๅๅฎน็ๆ้
      id-token: write  # ้่ฆๅๅฅIDไปค็็ๆ้

    steps:
    - name: Download all the ๐ฆ dists  # ไธ่ฝฝๆๆๅๅๅ็ๆญฅ้ชค
      uses: actions/download-artifact@v4  # ไฝฟ็จactions/download-artifactๅจไฝๆฅไธ่ฝฝๆๅปบๅฅฝ็ๅ
      with:
        name: python-package-distributions  # ๆๅฎ่ฆไธ่ฝฝ็artifactๅ็งฐ
        path: dist/  # ๆๅฎไธ่ฝฝๅฐ็่ทฏๅพ
  - name: Publish ๐ฆ to PyPI  # ๅๅธๅๅๅๅฐPyPI็ๆญฅ้ชค
      uses: pypa/gh-action-pypi-publish@release/v1  # ไฝฟ็จpypa/gh-action-pypi-publishๅจไฝๆฅๅๅธๅ
      with:
        repository-url: https://upload.pypi.org/legacy/  # ็กฎไฟไฝฟ็จๆญฃ็กฎ็PyPIไธไผURL



  publish-to-github-release:
    name: Publish ๐ PyTeXMK ๐ฆ to GitHub Release  # ๅฎไนๅๅธๅฐGitHub Releaseไฝไธ็ๅ็งฐ
    if: startsWith(github.ref, 'refs/tags/')  # ๅชๆๅจๆจ้ๆ็ญพๆถๆๆง่กๆญคไฝไธ
    needs: build  # ๆๅฎๆญคไฝไธไพ่ตไบbuildไฝไธ
    runs-on: ubuntu-latest  # ๆๅฎ่ฟ่กๆญคไฝไธ็ๆไฝ็ณป็ป

    steps:
    - name: Download all the ๐ฆ dists  # ไธ่ฝฝๆๆๅๅๅ็ๆญฅ้ชค
      uses: actions/download-artifact@v4  # ไฝฟ็จactions/download-artifactๅจไฝๆฅไธ่ฝฝๆๅปบๅฅฝ็ๅ
      with:
        name: python-package-distributions  # ๆๅฎ่ฆไธ่ฝฝ็artifactๅ็งฐ
        path: dist/  # ๆๅฎไธ่ฝฝๅฐ็่ทฏๅพ

    - name: Publish to GitHub Release  # ๅๅธๅฐGitHub Release็ๆญฅ้ชค
      uses: softprops/action-gh-release@v2.0.8  # ไฝฟ็จsoftprops/action-gh-releaseๅจไฝๆฅๅๅธๅฐGitHub Release
      with:
        token: ${{ secrets.PUBLISH_PYTEXMK }}  # ๆฟๆขไธบๅฎ้็GitHub Token
        name: PyTeXMK ${{ github.ref_name }} # 
        files: dist/*  # ๆๅฎ่ฆๅๅธ็ๆไปถ่ทฏๅพ
        
